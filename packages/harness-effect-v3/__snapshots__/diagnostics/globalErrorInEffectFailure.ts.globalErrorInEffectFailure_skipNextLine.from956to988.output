// code fix globalErrorInEffectFailure_skipNextLine  output for range 956 - 988
import { Data, Effect } from "effect"

class CustomError extends Data.TaggedError("CustomError")<{}> {}

export const shouldNotReport = Effect.fail(new CustomError())

export const shouldReport = Effect.fail(new Error("global error"))
export const shouldReport2 = Effect.fail(new globalThis.Error("global error"))

export class BaseExtendsError extends Error {
}

// this is not fine because it extends the global Error type without changing it
export const shouldReport3 = Effect.fail(new BaseExtendsError())

export class BaseExtendsErrorWithTag extends Error {
  readonly _tag = "BaseExtendsErrorWithTag"
}

// this is fine because it has some property that is not the global Error type
export const shouldNotReport2 = Effect.fail(new BaseExtendsErrorWithTag())

// Additional test cases for Effect.gen with global Error

// should report - global Error in Effect.gen
export const shouldReportGen = Effect.gen(function* () {
  // @effect-diagnostics-next-line globalErrorInEffectFailure:off
  return yield* Effect.fail(new Error("global error in gen"))
})

// should not report - custom error in Effect.gen
export const shouldNotReportGen = Effect.gen(function* () {
  return yield* Effect.fail(new CustomError())
})

// should report - global Error in Effect.map
export const shouldReportMap = Effect.succeed(1).pipe(
  Effect.flatMap(() => Effect.fail(new Error("global error in map")))
)

// should not report - new Error outside of Effect context
export function shouldNotReportNonEffect() {
  throw new Error("this is not in an Effect")
}

// should report - mapError converting to global Error
export const shouldReportMapError = Effect.fail(new CustomError()).pipe(
  Effect.mapError(() => new Error("mapped to global error"))
)
